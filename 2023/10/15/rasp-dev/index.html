<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>树莓派搭建开发环境 | Smiecj的小窝</title><meta name="keywords" content="Linux,树莓派"><meta name="author" content="smiecj,xxx@gmail.com"><meta name="copyright" content="smiecj"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="树莓派实践 v2">
<meta property="og:type" content="article">
<meta property="og:title" content="树莓派搭建开发环境">
<meta property="og:url" content="http://smiecj.github.io/2023/10/15/rasp-dev/index.html">
<meta property="og:site_name" content="Smiecj的小窝">
<meta property="og:description" content="树莓派实践 v2">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://smiecj.github.io/2023/10/15/rasp-dev/rasp.jpeg">
<meta property="article:published_time" content="2023-10-14T16:00:00.000Z">
<meta property="article:modified_time" content="2023-11-26T16:00:00.000Z">
<meta property="article:author" content="smiecj">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="树莓派">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://smiecj.github.io/2023/10/15/rasp-dev/rasp.jpeg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://smiecj.github.io/2023/10/15/rasp-dev/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '树莓派搭建开发环境',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-27 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Smiecj的小窝" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://avatars.githubusercontent.com/u/14009307" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2023/10/15/rasp-dev/rasp.jpeg')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Smiecj的小窝</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 文章</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">树莓派搭建开发环境</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-14T16:00:00.000Z" title="发表于 2023-10-15 00:00:00">2023-10-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-26T16:00:00.000Z" title="更新于 2023-11-27 00:00:00">2023-11-27</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%94%9F%E6%B4%BB/">生活</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E7%94%9F%E6%B4%BB/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="树莓派搭建开发环境"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p><a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/sg8bsfQe3YK72_d3Ss8vyw">本文公众号</a></p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>自从上次心血来潮给树莓派装完系统，一直没想好怎么具体使用它的场景，它就这样默默地躺在抽屉吃灰了一年</p>
<p>再次想起它，是一个周日的下午：收到之前在腾讯云买的云服务器快过期的提醒，一个4核8G内存的ubuntu，平时主要用它作为开发机，在本地电脑性能不够的时候，辅助 <strong>调试代码</strong>，以及 <strong>编译服务</strong> ，还是非常顺滑的</p>
<p>但随后登录控制台，一看续期的价格，同样性能比去年要贵个200多（去年 388，今年 646），横向对比了国内几个云厂商价格也都差不多，索性放弃续期了，想着有没有其他办法整个独立的开发环境呢？</p>
<p>让家里台式机一直跑着是种方法，windows 的 wsl 已经非常完善，完全可以当 linux 开发机用了</p>
<p>不过目前自己要跑的服务，也用不上台式机的性能，还有没有<strong>更轻量</strong>运行的方式呢？</p>
<p>这不就正好，终于可以重新唤醒尘封已久的树莓派咯。虽然4U4G的性能说不上绰绰有余，但就跑几个服务来说还是足够的</p>
<!--毕竟 windows 后台还要跑一堆其他东西，空闲时候比linux系统更耗电-->

<h2 id="本文内容"><a href="#本文内容" class="headerlink" title="本文内容"></a>本文内容</h2><ul>
<li><p>搭建开发环境（docker、各开发语言、code server）</p>
</li>
<li><p>文件服务器（samba）</p>
</li>
<li><p>监控（prometheus + grafana + node exporter）</p>
</li>
<li><p>远程桌面连接</p>
</li>
<li><p>智能开关</p>
</li>
<li><p>后续展望</p>
</li>
</ul>
<h2 id="系统准备"><a href="#系统准备" class="headerlink" title="系统准备"></a>系统准备</h2><p>我的树莓派上安装的是 ubuntu 22，通过 <a target="_blank" rel="noopener" href="https://www.raspberrypi.com/news/raspberry-pi-imager-imaging-utility">raspberry pi imager</a>（官方刷系统工具）刷入系统并安装，具体的安装可以参考去年写的<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/N6fEJuDNg5vYKcbl5x_7KA">博客</a></p>
<h2 id="安装开发环境"><a href="#安装开发环境" class="headerlink" title="安装开发环境"></a>安装开发环境</h2><p>笔者比较熟悉的开发模式: docker + 各语言开发环境 + <a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s/H6QUS0CtW_qUBSdXTK8E_w">vscode</a>，在树莓派上原样进行安装</p>
<h3 id="docker"><a href="#docker" class="headerlink" title="docker"></a>docker</h3><p>安装 docker 的目的主要是能快速启动与主机环境隔离的容器，并进行服务编译。特别是编译 C++ 服务的时候，centos、ubuntu 这类的系统镜像自带的 gcc、glibc 版本往往不足要求，需要升级，但 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/GNU_C%E5%87%BD%E5%BC%8F%E5%BA%AB">glibc</a> 的升级稍有操作不慎，又会对系统本身造成影响，所以还是建议在容器中编译相关服务</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用阿里源安装 docker</span></span><br><span class="line">curl -fsSL https://get.docker.com -o get-docker.sh</span><br><span class="line">sh get-docker.sh --mirror Aliyun</span><br></pre></td></tr></table></figure>

<p>安装后查看版本:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">❯ docker -v</span><br><span class="line">Docker version 24.0.7, build afdd53b</span><br></pre></td></tr></table></figure>

<p>关于在国内拉取容器镜像下载加速方式: 对不同的镜像仓库，如 <a target="_blank" rel="noopener" href="https://hub.docker.com/search?image_filter=official">docker hub 官方镜像</a>、registry.k8s.io（kubernetes 相关服务的镜像仓库，旧域名是 <a target="_blank" rel="noopener" href="https://kubernetes.io/blog/2022/11/28/registry-k8s-io-faster-cheaper-ga">k8s.gcr.io</a>）、quay.io（红帽镜像仓库）等，使用的仓库代理地址各有不同</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 原拉取镜像方式</span></span><br><span class="line">docker pull mysql:8.0.31</span><br><span class="line">docker pull registry.k8s.io/kube-apiserver:v1.17.3</span><br><span class="line">docker pull quay.io/dexidp/dex:v2.28.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用镜像仓库代理拉取方式</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># docker hub 官方镜像: 设置中科大镜像加速器</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 参考: https://mirrors.ustc.edu.cn/help/dockerhub.html</span></span></span><br><span class="line">tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://docker.mirrors.ustc.edu.cn&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 重启docker 后再拉取</span></span></span><br><span class="line">docker pull mysql:8.0.31</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># registry.k8s.io</span></span></span><br><span class="line">docker pull registry.aliyuncs.com/google_containers/kube-apiserver:v1.17.3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># quay</span></span></span><br><span class="line">docker pull quay.mirrors.ustc.edu.cn/dexidp/dex:v2.28.1</span><br></pre></td></tr></table></figure>

<h3 id="各个语言的开发环境"><a href="#各个语言的开发环境" class="headerlink" title="各个语言的开发环境"></a>各个语言的开发环境</h3><p>关于各种开发语言如何安装环境，网上教程一大把，过程无外乎是下载和解压安装包、环境变量配置和下载源配置，熟悉了操作也快，但每次重装系统，或者基于一个基础镜像安装开发环境，都需要重新操作一遍还是挺麻烦的</p>
<p>笔者把常用语言和服务的安装脚本整理在 <a target="_blank" rel="noopener" href="https://github.com/smiecj/shell-tools">shell-tools</a> 这个仓库了，可以直接一行指令帮我安装，还可以指定需要安装的版本</p>
<p>比如安装 go、java、python 和 nodejs:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> go_version: 指定版本，默认版本在 Makefile.vars.version 中定义</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> NET=CN: go 安装包将从国内源加速下载，并在安装后设置 GOPROXY 为 goproxy.cn</span></span><br><span class="line">NET=CN go_version=1.21.4 make golang</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将安装 jdk1.8 (默认开发环境 JAVA_HOME)、jdk17（vscode java 插件使用）、maven、gradle</span></span><br><span class="line">NET=CN make java</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将安装 conda、python 3.12</span></span><br><span class="line">NET=CN python3_version=3.12 make python3</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将安装 nodejs 18.16.1</span></span><br><span class="line">NET=CN nodejs_version=v18.16.1 make nodejs</span><br></pre></td></tr></table></figure>

<p>升级 gcc、glibc，也可以使用这个脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 升级 gcc 到 12.3.0</span></span><br><span class="line">NET=CN gcc_version=12.3.0 make gcc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 升级 glibc 到 2.35</span></span><br><span class="line">NET=CN glibc_version=2.35 make glibc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> glibc 的默认安装地址为 /usr/<span class="built_in">local</span>，因此使用前需要设置环境变量，把 /usr/<span class="built_in">local</span>/lib 放到前面</span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 参考: https://unix.stackexchange.com/a/67783</span></span></span><br><span class="line">export LD_LIBRARY_PATH=/usr/local/lib:/usr/local/lib64:/lib</span><br></pre></td></tr></table></figure>

<h3 id="code-server"><a href="#code-server" class="headerlink" title="code server"></a>code server</h3><p>关于 vscode 之前写过常用插件的介绍，远程开发模式下，本地装 vscode，通过 remote ssh 连接到远端服务器，再安装各个开发语言的插件，体验还是很丝滑的</p>
<p><img src="/2023/10/15/rasp-dev/01.png" alt="local architecture"></p>
<p>架构如<a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/remote/faq#_how-do-the-remote-development-extensions-work">上图</a>: 本地运行 vscode 的前端UI框架，后台服务器自动运行 vscode server，负责具体项目和具体开发语言的插件的运行，并提供 debugger、terminal 等功能</p>
<p>更进一步，我们还可以直接在远端服务器安装 <a target="_blank" rel="noopener" href="https://coder.com/docs/code-server/latest">code server</a>，它是 vscode 的在线版，相当于UI服务也在服务器上运行，直接通过浏览器就能打开了</p>
<p><img src="/2023/10/15/rasp-dev/code-server-architecture.png" alt="local and remote architecture"></p>
<p>vscode 和 code server 的对比如<a target="_blank" rel="noopener" href="https://insujang.github.io/2019-11-10/code-server">上图</a>，区别就是 nodejs（即 UI）也是运行在服务器上的，本机只需打开浏览器即可</p>
<p>code server 在树莓派的安装和配置方式如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 通过 shell-tools 安装 code server 4.19.0</span></span><br><span class="line">code_server_version=4.19.0 make code-server</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 配置: /opt/modules/code-server-4.18.0-linux-arm64/config.yaml</span></span><br><span class="line">bind-addr: 0.0.0.0:8080</span><br><span class="line">auth: password</span><br><span class="line">password: codeserver</span><br><span class="line">cert: false</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">nohup /opt/modules/code-server-4.19.0-linux-arm64/bin/code-server --config /opt/modules/code-server-4.19.0-linux-arm64/config.yaml &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>之后打开 http://树莓派内网ip:8080 就能开始愉快地享受网页版 vscode 了</p>
<p><img src="/2023/10/15/rasp-dev/05.png" alt="code server 效果"></p>
<p>扩展: 如果你想把 code server 提供给小伙伴们一起使用，配置就比较麻烦了，需要加一层 <a target="_blank" rel="noopener" href="https://coder.com/docs/code-server/latest/guide#external-authentication">oauth proxy</a> 或其他代理，以支持多用户登录。 <a target="_blank" rel="noopener" href="https://github.com/jupyterhub/jupyter-server-proxy">jupyterhub</a> 也是一种选择，后续有机会可以写写具体怎么做</p>
<!--
### minikube

后续: 测试 jupyter
-->

<h2 id="文件服务器"><a href="#文件服务器" class="headerlink" title="文件服务器"></a>文件服务器</h2><p>除了用于开发，树莓派作为常驻 linux 主机，还可以安装 samba 并作为文件服务器，视频、音乐等媒体统一放到一块硬盘上，作为本地的媒体库</p>
<h3 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h3><p>samba 服务对应的 <a target="_blank" rel="noopener" href="https://baike.baidu.com/item/samba/455025">SMB</a>（Server Message Block） 是一种在局域网中共享文件的协议，直接说下它在linux系统的安装方法</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 samba，并添加 samba 的访问用户（注意和系统用户不同）</span></span><br><span class="line">apt -y install samba samba-common-bin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加用于登录 samba 的用户: pi, 并设置密码</span></span><br><span class="line">smbpasswd -a pi</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 激活用户</span></span><br><span class="line">smbpasswd -e pi</span><br></pre></td></tr></table></figure>

<p>安装后，在 /etc/samba/smb.conf 中配置开放访问的目录</p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># vim /etc/samba/smb.conf</span></span><br><span class="line"></span><br><span class="line"><span class="section">[music]</span></span><br><span class="line"><span class="attr">path</span> = /data/music</span><br><span class="line"><span class="attr">writeable</span>=<span class="literal">Yes</span></span><br><span class="line">valid <span class="attr">users</span> = pi</span><br><span class="line">create <span class="attr">mask</span>=<span class="number">0777</span></span><br><span class="line">directory <span class="attr">mask</span>=<span class="number">0777</span></span><br><span class="line"><span class="attr">public</span>=<span class="literal">yes</span></span><br><span class="line"><span class="attr">browseable</span>=<span class="literal">yes</span></span><br></pre></td></tr></table></figure>

<h3 id="挂载机械硬盘"><a href="#挂载机械硬盘" class="headerlink" title="挂载机械硬盘"></a>挂载机械硬盘</h3><p>在尝试把之前买的机械硬盘（作为媒体数据盘）挂载到树莓派的时候，遇上了一点小问题: 硬盘格式已经是 NTFS 并且放了一些数据了，但linux 系统无法直接读取，需要安装 <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/NTFS-3G">ntfs-3g</a> 驱动才行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt -y install ntfs-3g</span><br></pre></td></tr></table></figure>

<p>并在 /etc/fstab 中设置开机自动挂盘，参考</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/dev/sdb1       /data/music   ntfs-3g defaults,nofail,uid=1000,gid=1000,umask=0007,x-systemd.device-timeout=5         0       0</span><br></pre></td></tr></table></figure>

<h2 id="远程桌面"><a href="#远程桌面" class="headerlink" title="远程桌面"></a>远程桌面</h2><p>对 linux 系统来说，平时开发写写代码敲敲指令，是不太需要访问桌面的。不过有时想体验 linux 版的应用（QQ），还是可以装个远程桌面来体验一下</p>
<p>常见的远程桌面协议是 xrdp 和 vnc，这里我们通过 xrdp 来配置:</p>
<!--
[参考-Installing an XRDP Server on Ubuntu 20.04](https://www.shells.com/l/en-US/tutorial/Installing-an-XRDP-Server-on-Ubuntu-20-04)

[xrdp](https://github.com/neutrinolabs/xrdp): 远程桌面协议（RDP）的一种开源实现

[xfce](https://zh.wikipedia.org/zh-cn/Xfce): 一个轻量的 unix 桌面版

[lxde](https://zh.wikipedia.org/wiki/LXDE): 一种轻量而快速的桌面环境

-->

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 xrdp</span></span><br><span class="line">apt -y install xrdp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 lxde cinnamon 桌面</span></span><br><span class="line">apt -y install lxde cinnamon-desktop-environment</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> xsession 在用户登录桌面系统后被执行，可用于定制化桌面</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 参考: https://unix.stackexchange.com/a/47426</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 cinnamon 作为桌面</span></span><br><span class="line">echo cinnamon &gt; ~/.xsession</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 修改 /etc/xrdp/startwm.sh 并在 &quot;fi&quot; 和 “test -x” 中间加3行</span></span></span><br><span class="line">unset DBUS_SESSION_BUS_ADDRESS</span><br><span class="line">unset XDG_RUNTIME_DIR</span><br><span class="line">startlxde</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 xrdp</span></span><br><span class="line">systemctl start xrdp</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或: /etc/init.d/xrdp restart</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开机自启动</span></span><br><span class="line">systemctl enable xrdp</span><br></pre></td></tr></table></figure>

<p>xrdp 的端口 3389 可以在 /etc/xrdp/xrdp.ini 配置中查看和修改</p>
<p>然后通过 microsoft remote desktop 连接:</p>
<p><img src="/2023/10/15/rasp-dev/06.png" alt="桌面"></p>
<p>非常简洁的桌面</p>
<p>然后我们可以安装新版适配了 linux 的 QQ，从<a target="_blank" rel="noopener" href="https://im.qq.com/linuxqq/index.shtml">官网</a>下载</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载</span></span><br><span class="line">wget https://dldir1.qq.com/qqfile/qq/QQNT/2355235c/linuxqq_3.1.1-11223_arm64.deb</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">dpkg -i linuxqq_3.1.1-11223_arm64.deb</span><br></pre></td></tr></table></figure>

<!--
参考: https://cloud.tencent.com/developer/article/2301512
-->

<h2 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h2><p>到这一步，我们给树莓派装的开发环境算是基本弄好了，可以愉快地在上面构建镜像、运行服务，不过摸着那微微发烫的 cpu，担心也随之而来: 是不是有个好看的面板，能直接看到当前树莓派的状态，做个监控更好呢？</p>
<p>那就话不多说，开始整看板吧</p>
<h3 id="获取树莓派的性能指标"><a href="#获取树莓派的性能指标" class="headerlink" title="获取树莓派的性能指标"></a>获取树莓派的性能指标</h3><!--
[Parsing the GPU temperature outputs](https://www.cyberciti.biz/faq/linux-find-out-raspberry-pi-gpu-and-arm-cpu-temperature-command/)
-->

<p>先来看看命令行获取树莓派 cpu 的温度的方式:</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/lakeheart879/article/details/77336393">参考-使用 vcgencmd 指令查看 Raspberry Pi 的 CPU 溫度、運行速度與電壓等資訊</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vcgencmd measure_temp | grep  -o -E &#x27;[[:digit:]].*&#x27;</span><br></pre></td></tr></table></figure>

<p><img src="/2023/10/15/rasp-dev/07.png" alt="cpu 温度"></p>
<p>vcgencmd 指令是基于树莓派的内核 <a target="_blank" rel="noopener" href="https://github.com/raspberrypi/firmware">firmware</a> 自带的指令，能拿到关于系统资源和硬件状态相关信息，如时钟频率、电压、内存等</p>
<p>但通过指令获取参数的方式，采集起来需要额外写脚本，相比 exporter 的方式来说还是不太方便，那么有没有原生的 exporter 可以直接拿到温度数据呢？</p>
<h3 id="node-exporter"><a href="#node-exporter" class="headerlink" title="node exporter"></a>node exporter</h3><p>前面说的系统指令只是粗略看看 cpu 的指标，要想持续监控，还得通过 prometheus 采集、exporter 提供系统指标的机制，把相关指标提前暴露出来</p>
<p><a target="_blank" rel="noopener" href="https://github.com/prometheus/node_exporter">node exporter</a> 是提供系统相关监控指标的服务，在树莓派上部署它的 arm 版本后，可通过 <strong>node_thermal_zone_temp</strong> 指标获取温度，数据来源是系统文件 /sys/class/thermal/thermal_zone0/temp 即由系统直接提供的 cpu 温度数据</p>
<h3 id="部署-prometheus、node-exporter-和-grafana"><a href="#部署-prometheus、node-exporter-和-grafana" class="headerlink" title="部署 prometheus、node exporter 和 grafana"></a>部署 prometheus、node exporter 和 grafana</h3><p>继续使用 shell-tools 工具一键安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 prometheus 和 node exporter</span></span><br><span class="line">prometheus_version=2.45.0 node_exporter_version=1.6.1 NET=CN make prometheus</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 grafana</span></span><br><span class="line">grafana_version=10.2.0 NET=CN make grafana</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">/opt/modules/prometheus/prometheus --web.enable-lifecycle --config.file=/opt/modules/prometheus/prometheus.yml --web.listen-address=:3001</span><br><span class="line"></span><br><span class="line">/opt/modules/grafana/bin/grafana-server --homepath /opt/modules/grafana --config /opt/modules/grafana/conf/custom.ini</span><br><span class="line"></span><br><span class="line">/opt/modules/node_exporter/node_exporter --web.listen-address=&quot;:9100&quot;</span><br></pre></td></tr></table></figure>

<p>安装后，在 prometheus 配置文件中添加 node exporter 的本地地址即可开始采集指标</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># vim /opt/modules/prometheus/prometheus.yml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">scrape_configs:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&quot;node_exporter&quot;</span></span><br><span class="line">    <span class="attr">static_configs:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">targets:</span> [<span class="string">&quot;localhost:9100&quot;</span>] <span class="comment"># node exporter 地址</span></span><br></pre></td></tr></table></figure>

<h3 id="prometheus-对接-grafana"><a href="#prometheus-对接-grafana" class="headerlink" title="prometheus 对接 grafana"></a>prometheus 对接 grafana</h3><p>采集到指标后，关键的一步就是用“酷炫”的grafana看板展示出来，让我们能及时看到系统状态</p>
<p>node exporter 的官方的看板是 <a target="_blank" rel="noopener" href="https://grafana.com/grafana/dashboards/1860-node-exporter-full">node exporter full</a>，分类非常详细，导入看板的 json 文件，并添加 prometheus 数据源（localhost:3001）即可</p>
<p><img src="/2023/10/15/rasp-dev/10.png" alt="导入看板"></p>
<p><img src="/2023/10/15/rasp-dev/11.png" alt="选择 prometheus 数据源"></p>
<p><img src="/2023/10/15/rasp-dev/04.png" alt="看板效果"></p>
<!--
嵌入式Linux下获取CPU温度方法
https://blog.csdn.net/qq_20553613/article/details/107703442
-->

<h2 id="开机服务自动启动"><a href="#开机服务自动启动" class="headerlink" title="开机服务自动启动"></a>开机服务自动启动</h2><p>前面我们给树莓派已经安装了一系列服务，那么有时候树莓派要重启，我们会想让这些服务也在系统重启后自动启动。docker 这种通过 systemctl 管理的服务，直接执行 systemctl enable docker 就可以了，手动安装的 code server 、prometheus，应该怎么配置呢？</p>
<p>方法也有很多种，常见的有: rc.local、init.d、crontab @reboot 等方法，它们执行的时机各有不同</p>
<p><a target="_blank" rel="noopener" href="https://shumeipai.nxez.com/2023/05/13/run-a-program-on-your-raspberry-pi-at-startup.html">参考-在树莓派上设置应用程序开机启动的五种方法</a></p>
<h3 id="什么时候触发执行"><a href="#什么时候触发执行" class="headerlink" title="什么时候触发执行"></a>什么时候触发执行</h3><p>linux 系统启动后，<a target="_blank" rel="noopener" href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/4/html/reference_guide/s2-boot-init-shutdown-init">/sbin/init</a> 脚本会进行一众系统服务的初始化，顺序我们可以通过 systemd-analyze plot &gt; startup_order.svg 导出，一些自动启动的脚本启动顺序如下:</p>
<p>/etc/init.d: 最先初始化的一批系统服务</p>
<!--顺序依赖于服务配置，和 systemd 服务的定义方式类似，可以通过编写 -->

<p>rc.local: network 即网络服务启动之后</p>
<p>crontab @reboot: network 启动之前</p>
<!-- -->

<p>为什么要特别提到启动顺序，因为有的服务依赖网络相关的基础服务（如网卡初始化），如果通过 /etc/init.d 或是 crontab @reboot 很可能启动失败。相对比，rc.local 的启动顺序较后，可以保证在系统基础服务启动后开始。另外从配置方式来看，systemctl 和 /etc/init.d 都需要基于一定的格式规范，如服务名、依赖哪些服务等，rc.local 则直接写入服务的启动指令即可</p>
<p>下面我们来看看 rc.local 如何配置</p>
<h3 id="rc-local-添加服务启动指令"><a href="#rc-local-添加服务启动指令" class="headerlink" title="rc.local 添加服务启动指令"></a>rc.local 添加服务启动指令</h3><p>root 用户下编辑 /etc/rc.local 文件，添加服务的启动指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim /etc/rc.local</span></span><br><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 prometheus</span></span><br><span class="line">nohup /opt/modules/prometheus/prometheus --web.enable-lifecycle --config.file=/opt/modules/prometheus/prometheus.yml --web.listen-address=:3001 &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 grafana</span></span><br><span class="line">nohup /opt/modules/grafana/bin/grafana-server --homepath /opt/modules/grafana --config /opt/modules/grafana/conf/custom.ini &gt; /dev/null 2&gt;&amp;1 &amp;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 node exporter</span></span><br><span class="line">nohup /opt/modules/node_exporter/node_exporter --web.listen-address=&quot;:9100&quot; &gt; /dev/null 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>之后通过 chmod +x /etc/rc.local 添加可执行文件，重启树莓派再次登录，可以看到相关服务已经运行起来了</p>
<p>另一个注意点是 rc.local 中的指令是串行执行，前面的指令报错，后面的也不会执行，所以也建议通过 nohup 即后台方式启动服务</p>
<!--
另外看一些帖子，即使 rc.local 执行顺序在 network 之后，在启动时执行 wget 下载依然有概率失败

service networking restart

systemctl status networking

oneshot: https://askubuntu.com/a/1072463

/etc/network/if-up.d: https://askubuntu.com/a/431449

关于脚本执行: https://askubuntu.com/a/243083
-->

<h2 id="智能插座"><a href="#智能插座" class="headerlink" title="智能插座"></a>智能插座</h2><p>毕竟性能有限，随着我们在树莓派上部署的服务越来越多，也难免会遇到资源用尽，直接卡住无法连接的情况，除了重启没有别的恢复办法</p>
<p>好几次在外面远程连接家里树莓派，跑了几个比较吃资源的服务卡住之后，又没法重启，真的是很无奈，索性搞了个小米智能插座，感受了一波物联网带来实际的便利</p>
<p><img src="/2023/10/15/rasp-dev/08.jpeg" alt="只够插一个插头的位置，稍显不足"></p>
<p><img src="/2023/10/15/rasp-dev/09.png" alt="还能看到供电量"></p>
<h2 id="后续展望"><a href="#后续展望" class="headerlink" title="后续展望"></a>后续展望</h2><p>经过了一个多月的折腾，我的树莓派终于可以作为开发服务器长期跑起来了。相比开头说的云服务器，性能方面稍弱，但也带来可以对接本地数据、可随时在手机端重启等好处</p>
<p>之后还能在上面跑什么服务，或者还能和现实世界有什么交互呢？我也还没有特别想好，就粗略地列一列零散的点子吧，看看以后有没有时间继续折腾一下</p>
<!--
本地运行一些定时服务，构建镜像，运行服务，备份数据等（如监控数据）

系统备份: 前面的安装服务、修改服务配置和系统配置相关的操作，如果
-->

<p>nas: 我是真没想到竟然真有人去把树莓派当作 nas，<a target="_blank" rel="noopener" href="https://post.smzdm.com/p/a4p6d8r8">参考</a>，数据传输速度上的瓶颈应该还是挺明显的，当作小型文件服务器才比较现实</p>
<p>本地文档库+媒体库: 归档自己所有的音乐、相册、视频、电子书等</p>
<p>传感器: 搞个空气质量检测器，<a target="_blank" rel="noopener" href="https://www.cirmall.com/articles/35968">参考</a></p>
<!--
找一套物联网框架

https://www.xiaoweigod.com/network/2235.html

https://iot.mi.com/new/doc/accesses/direct-access/other-platform-access/control-api 

-->

<!--

## 最后

谨以这篇不那么硬核的技术文章，献给激励我创作的动力来源，总是拥有古灵精怪的魅力，今天全世界最独一无二的男人，新婚快乐！

--></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:xxx@gmail.com">smiecj</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://smiecj.github.io/2023/10/15/rasp-dev/">http://smiecj.github.io/2023/10/15/rasp-dev/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://smiecj.github.io" target="_blank">Smiecj的小窝</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Linux/">Linux</a><a class="post-meta__tags" href="/tags/%E6%A0%91%E8%8E%93%E6%B4%BE/">树莓派</a></div><div class="post_share"><div class="social-share" data-image="/2023/10/15/rasp-dev/rasp.jpeg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/23/golang-origin/"><img class="prev-cover" src="/2023/10/23/golang-origin/golang.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">go 语言介绍</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/08/vaundy-todome/"><img class="next-cover" src="/2023/10/08/vaundy-todome/01.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">致命一击</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2022/03/12/rasp-ssd-frp/" title="树莓派通过 SSD 部署 和 配置内网穿透"><img class="cover" src="/2022/03/12/rasp-ssd-frp/rasp01.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-03-12</div><div class="title">树莓派通过 SSD 部署 和 配置内网穿透</div></div></a></div><div><a href="/2022/08/13/dockerfile-compose-hdfs/" title="通过 Docker Compose 本地启动 hadoop 集群"><img class="cover" src="/img/blog_img/hadoop.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-13</div><div class="title">通过 Docker Compose 本地启动 hadoop 集群</div></div></a></div><div><a href="/2022/12/28/docker-command/" title="Docker 常用指令"><img class="cover" src="/img/blog_img/docker_commands.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-12-28</div><div class="title">Docker 常用指令</div></div></a></div><div><a href="/2022/05/18/dockerfile-compose/" title="通过 Docker Compose 本地启动 zk 集群"><img class="cover" src="https://iamondemand.com/wp-content/uploads/2015/04/cool-docker-image.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-05-18</div><div class="title">通过 Docker Compose 本地启动 zk 集群</div></div></a></div><div><a href="/2023/04/14/shell-tools/" title="shell 常用工具指令"><img class="cover" src="/img/blog_img/shell.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-14</div><div class="title">shell 常用工具指令</div></div></a></div><div><a href="/2022/09/22/sealos/" title="通过 sealos 部署 k8s 集群"><img class="cover" src="https://docs.sealos.io/img/sealos-left.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-09-22</div><div class="title">通过 sealos 部署 k8s 集群</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/14009307" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">smiecj</div><div class="author-info__description">写写生活，做做笔记，聊聊日常</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">43</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">标签</div><div class="length-num">39</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">分类</div><div class="length-num">27</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/smiecj"><i class="fab fa-github"></i><span>访问主页</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9C%AC%E6%96%87%E5%86%85%E5%AE%B9"><span class="toc-number">2.</span> <span class="toc-text">本文内容</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B3%BB%E7%BB%9F%E5%87%86%E5%A4%87"><span class="toc-number">3.</span> <span class="toc-text">系统准备</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E8%A3%85%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">4.</span> <span class="toc-text">安装开发环境</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#docker"><span class="toc-number">4.1.</span> <span class="toc-text">docker</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%90%84%E4%B8%AA%E8%AF%AD%E8%A8%80%E7%9A%84%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83"><span class="toc-number">4.2.</span> <span class="toc-text">各个语言的开发环境</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#code-server"><span class="toc-number">4.3.</span> <span class="toc-text">code server</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E6%9C%8D%E5%8A%A1%E5%99%A8"><span class="toc-number">5.</span> <span class="toc-text">文件服务器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#samba"><span class="toc-number">5.1.</span> <span class="toc-text">samba</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%82%E8%BD%BD%E6%9C%BA%E6%A2%B0%E7%A1%AC%E7%9B%98"><span class="toc-number">5.2.</span> <span class="toc-text">挂载机械硬盘</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A2"><span class="toc-number">6.</span> <span class="toc-text">远程桌面</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%91%E6%8E%A7"><span class="toc-number">7.</span> <span class="toc-text">监控</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E6%A0%91%E8%8E%93%E6%B4%BE%E7%9A%84%E6%80%A7%E8%83%BD%E6%8C%87%E6%A0%87"><span class="toc-number">7.1.</span> <span class="toc-text">获取树莓派的性能指标</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#node-exporter"><span class="toc-number">7.2.</span> <span class="toc-text">node exporter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2-prometheus%E3%80%81node-exporter-%E5%92%8C-grafana"><span class="toc-number">7.3.</span> <span class="toc-text">部署 prometheus、node exporter 和 grafana</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#prometheus-%E5%AF%B9%E6%8E%A5-grafana"><span class="toc-number">7.4.</span> <span class="toc-text">prometheus 对接 grafana</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%80%E6%9C%BA%E6%9C%8D%E5%8A%A1%E8%87%AA%E5%8A%A8%E5%90%AF%E5%8A%A8"><span class="toc-number">8.</span> <span class="toc-text">开机服务自动启动</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%A7%A6%E5%8F%91%E6%89%A7%E8%A1%8C"><span class="toc-number">8.1.</span> <span class="toc-text">什么时候触发执行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rc-local-%E6%B7%BB%E5%8A%A0%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8%E6%8C%87%E4%BB%A4"><span class="toc-number">8.2.</span> <span class="toc-text">rc.local 添加服务启动指令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%99%BA%E8%83%BD%E6%8F%92%E5%BA%A7"><span class="toc-number">9.</span> <span class="toc-text">智能插座</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%90%8E%E7%BB%AD%E5%B1%95%E6%9C%9B"><span class="toc-number">10.</span> <span class="toc-text">后续展望</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2023/12/06/program-100-qas/" title="互联网之100问"><img src="/2023/12/06/program-100-qas/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="互联网之100问"/></a><div class="content"><a class="title" href="/2023/12/06/program-100-qas/" title="互联网之100问">互联网之100问</a><time datetime="2023-12-05T16:00:00.000Z" title="发表于 2023-12-06 00:00:00">2023-12-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/31/emr-mongo-to-hive/" title="mongodb数据同步到hive"><img src="/2023/10/31/emr-mongo-to-hive/mongo.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="mongodb数据同步到hive"/></a><div class="content"><a class="title" href="/2023/10/31/emr-mongo-to-hive/" title="mongodb数据同步到hive">mongodb数据同步到hive</a><time datetime="2023-10-30T16:00:00.000Z" title="发表于 2023-10-31 00:00:00">2023-10-31</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/23/golang-origin/" title="go 语言介绍"><img src="/2023/10/23/golang-origin/golang.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="go 语言介绍"/></a><div class="content"><a class="title" href="/2023/10/23/golang-origin/" title="go 语言介绍">go 语言介绍</a><time datetime="2023-10-22T16:00:00.000Z" title="发表于 2023-10-23 00:00:00">2023-10-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/15/rasp-dev/" title="树莓派搭建开发环境"><img src="/2023/10/15/rasp-dev/rasp.jpeg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="树莓派搭建开发环境"/></a><div class="content"><a class="title" href="/2023/10/15/rasp-dev/" title="树莓派搭建开发环境">树莓派搭建开发环境</a><time datetime="2023-10-14T16:00:00.000Z" title="发表于 2023-10-15 00:00:00">2023-10-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/10/08/vaundy-todome/" title="致命一击"><img src="/2023/10/08/vaundy-todome/01.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="致命一击"/></a><div class="content"><a class="title" href="/2023/10/08/vaundy-todome/" title="致命一击">致命一击</a><time datetime="2023-10-07T16:00:00.000Z" title="发表于 2023-10-08 00:00:00">2023-10-08</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By smiecj</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '40d352b09238233a6c88',
      clientSecret: 'db953d71dbaf0d65873a7ace2e60635fd475285a',
      repo: 'smiecj.github.io',
      owner: 'smiecj',
      admin: ['smiecj'],
      id: '02fb34b6c2fd6df0aac55eaa648ce067',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>