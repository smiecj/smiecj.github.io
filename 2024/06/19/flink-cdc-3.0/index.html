<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>flink cdc 3.0 &quot;å°é²œ&quot; | Smiecjçš„å°çª</title><meta name="keywords" content="å¤§æ•°æ®,flink,doris"><meta name="author" content="smiecj,xxx@gmail.com"><meta name="copyright" content="smiecj"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="schema è‡ªåŠ¨åŒæ­¥å’Œæ•´åº“åŒæ­¥åŠŸèƒ½ä½“éªŒ">
<meta property="og:type" content="article">
<meta property="og:title" content="flink cdc 3.0 &quot;å°é²œ&quot;">
<meta property="og:url" content="http://smiecj.github.io/2024/06/19/flink-cdc-3.0/index.html">
<meta property="og:site_name" content="Smiecjçš„å°çª">
<meta property="og:description" content="schema è‡ªåŠ¨åŒæ­¥å’Œæ•´åº“åŒæ­¥åŠŸèƒ½ä½“éªŒ">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://smiecj.github.io/2024/06/19/flink-cdc-3.0/cover.png">
<meta property="article:published_time" content="2024-06-18T16:00:00.000Z">
<meta property="article:modified_time" content="2024-11-09T16:00:00.000Z">
<meta property="article:author" content="smiecj">
<meta property="article:tag" content="å¤§æ•°æ®">
<meta property="article:tag" content="flink">
<meta property="article:tag" content="doris">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://smiecj.github.io/2024/06/19/flink-cdc-3.0/cover.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://smiecj.github.io/2024/06/19/flink-cdc-3.0/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"æ‰¾ä¸åˆ°æ‚¨æŸ¥è¯¢çš„å†…å®¹ï¼š${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'å¤åˆ¶æˆåŠŸ',
    error: 'å¤åˆ¶é”™è¯¯',
    noSupport: 'æµè§ˆå™¨ä¸æ”¯æŒ'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'åˆšåˆš',
    min: 'åˆ†é’Ÿå‰',
    hour: 'å°æ—¶å‰',
    day: 'å¤©å‰',
    month: 'ä¸ªæœˆå‰'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'flink cdc 3.0 "å°é²œ"',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-11-10 00:00:00'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
    const detectApple = () => {
      if (GLOBAL_CONFIG_SITE.isHome && /iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Smiecjçš„å°çª" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="https://avatars.githubusercontent.com/u/14009307" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">46</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">28</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/2024/06/19/flink-cdc-3.0/cover.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Smiecjçš„å°çª</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> æœç´¢</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> åˆ†ç±»</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">flink cdc 3.0 &quot;å°é²œ&quot;</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">å‘è¡¨äº</span><time class="post-meta-date-created" datetime="2024-06-18T16:00:00.000Z" title="å‘è¡¨äº 2024-06-19 00:00:00">2024-06-19</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">æ›´æ–°äº</span><time class="post-meta-date-updated" datetime="2024-11-09T16:00:00.000Z" title="æ›´æ–°äº 2024-11-10 00:00:00">2024-11-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="flink cdc 3.0 &quot;å°é²œ&quot;"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">é˜…è¯»é‡:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h2 id="èƒŒæ™¯"><a href="#èƒŒæ™¯" class="headerlink" title="èƒŒæ™¯"></a>èƒŒæ™¯</h2><p>åœ¨å¤§æ•°æ®å®æ—¶åŒæ­¥çš„åœºæ™¯ä¸­ï¼Œä¸€ä¸ªå¸¸è§åœºæ™¯æ˜¯ä» mysql OLTP æ•°æ®åº“åŒæ­¥åˆ° doris OLAP æ•°æ®åº“ï¼Œå‰è€…å±äºä¸šåŠ¡ç³»ç»Ÿé€šå¸¸æƒ…å†µä¸‹ä½¿ç”¨çš„æ•°æ®åº“ï¼Œåè€…æä¾›ç»™ä¸šåŠ¡çš„åŒäº‹è¿›è¡Œé«˜å¹¶å‘ã€å¤§æ‰¹é‡çš„æ•°æ®è®¡ç®—å’Œåˆ†æ</p>
<p>ä»Šå¹´å¹´åˆæ—¶ï¼Œæˆ‘ä»¬è¿™é‡Œçš„éƒ¨ç½²æ–¹æ¡ˆè¿˜æ˜¯ flink cdc 2.4 + flink sqlï¼Œä»»åŠ¡åœ¨ yarn ä¸Šè¿è¡Œï¼Œæ¶æ„å¦‚ä¸‹:</p>
<p><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-2.4.png" alt="flink cdc 2.4 structure"></p>
<p>è¿™ä¸ªæ¶æ„åœ¨éœ€è¦åŒæ­¥çš„è¡¨ä¸å¤šçš„æƒ…å†µä¸‹ï¼Œç»´æŠ¤èµ·æ¥ä¸ç®—éº»çƒ¦ï¼Œä¸è¿‡ä¹Ÿæœ‰ä¸¤ä¸ªå®è·µä¸­å¾ˆå…³é”®çš„é—®é¢˜: é€šè¿‡ SQL æäº¤åæ¯å¼ è¡¨éƒ½ä¼šå•ç‹¬æ‹‰å– binlogï¼Œé€ æˆèµ„æºæµªè´¹ï¼Œä»¥åŠé¢‘ç¹æ‹‰å–é€ æˆ MySQL å‹åŠ›è¾ƒå¤§ï¼›å…¶æ¬¡æ˜¯ä¸æ”¯æŒè¡¨ç»“æ„åŒæ­¥ï¼Œæ¯”å¦‚ mysql æ–°å¢äº†å­—æ®µï¼Œè™½ç„¶ä¸ä¼šç›´æ¥å¯¼è‡´åŒæ­¥ä»»åŠ¡æŠ¥é”™ï¼ˆä¿®æ”¹å­—æ®µç±»å‹é™¤å¤–ï¼‰ï¼Œä½†æ˜¯ä¸€æ—¦ä¸šåŠ¡è¯´éœ€è¦ç”¨åˆ°è¿™ä¸ªå­—æ®µï¼Œé‚£æˆ‘å°±éœ€è¦åœ¨ flink sql ä¸­åŠ ä¸Šè¿™ä¸ªå­—æ®µï¼Œä¸‹æ¸¸çš„ doris æ‰‹åŠ¨æ‰§è¡Œ alter å»æ·»åŠ å­—æ®µï¼Œå†æŠŠ flink ä»»åŠ¡é‡å¯ï¼Œè¿™äº›æ“ä½œï¼Œæ¯”åˆ›å»ºä¸€ä¸ªæ–°çš„ä»»åŠ¡è¿˜è¦éº»çƒ¦</p>
<p>äºæ˜¯åœ¨çœ‹åˆ° flink 3.0 å¯¹ schema evolution å’Œæ‰¹é‡è¡¨åŒæ­¥æ”¯æŒä¹‹åï¼Œæˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ—¶é—´å»å°é²œï¼Œæ ¹æ®å®˜æ–¹æ–‡æ¡£: <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-cdc-docs-release-3.2/zh/docs/get-started/quickstart/mysql-to-doris">Streaming ELT åŒæ­¥ MySQL åˆ° Doris</a>ï¼Œåœ¨æœ¬åœ°è¿è¡Œäº†æ•´å¥— mysql ã€ doris ã€ flink ä»¥åŠ flink cdc ä»»åŠ¡ã€‚æœ¬æ–‡æ€»ç»“äº†æ•´å¥—æœåŠ¡éƒ¨ç½²è¿‡ç¨‹ï¼Œä¹Ÿæç¤ºä¸€äº›é‡åˆ°çš„å°å‘ï¼Œå¸Œæœ›åŠ©å¤§å®¶ä¸æ»‘ä½“éªŒ flink cdc</p>
<p>flink cdc 3.0 ä¹‹åçš„ä»»åŠ¡æ¶æ„å¦‚ä¸‹:<br><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-3.0.png" alt="flink cdc 3.0 structure"></p>
<!--
[Introduction](https://nightlies.apache.org/flink/flink-cdc-docs-release-3.2/zh/docs/deployment/standalone)
-->

<h2 id="flink-cdc-åŠŸèƒ½é€Ÿè§ˆ"><a href="#flink-cdc-åŠŸèƒ½é€Ÿè§ˆ" class="headerlink" title="flink cdc åŠŸèƒ½é€Ÿè§ˆ"></a>flink cdc åŠŸèƒ½é€Ÿè§ˆ</h2><p><a target="_blank" rel="noopener" href="https://github.com/apache/flink-cdc">flink cdc</a> æ˜¯ä¸€ä¸ªæ”¯æŒå®æ—¶åŒæ­¥çš„æ•°æ®æµæ¡†æ¶ï¼Œç›¸æ¯”å…¶ä»–ç¬¬ä¸‰æ–¹å®ç°çš„å®æ—¶åŒæ­¥æ¡†æ¶ï¼Œå¦‚ seatunnelã€chunjun ç­‰ï¼Œå®ƒçš„ä¼˜åŠ¿åœ¨äº flink ç¤¾åŒºåŸç”Ÿæ”¯æŒï¼Œç‰ˆæœ¬è¿­ä»£å’Œæ–°åŠŸèƒ½å‘å¸ƒæ›´å¿«ï¼Œä¸è¶³ç‚¹åœ¨äºç¼ºå°‘ä»»åŠ¡ç®¡ç†åŠŸèƒ½ï¼Œéœ€è¦è‡ªå·±åšå¥½ä»»åŠ¡ç›‘æ§å’Œè‡ªåŠ¨æ¢å¤æœºåˆ¶</p>
<p>3.0 æ¶æ„:<br><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-3.0-structure.png" alt="flink cdc 3.0 structure"></p>
<p><a target="_blank" rel="noopener" href="https://medium.com/@ipolyzos_/a-glimpse-into-flink-cdc-3-0-a985fb5895a5">å›¾ç‰‡æ¥æº-A Glimpse into Flink CDC 3.0</a></p>
<p>3.0 ä¹‹å cdc æ•´ä½“çš„æ¶æ„å°±å¾ˆæ¸…æ™°äº†ï¼Œæ¶æ„ä¸­å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„æ¦‚å¿µå¦‚ä¸‹ï¼š</p>
<p>CDC Client: æ–°çš„ç”¨äºæäº¤ä»»åŠ¡çš„å®¢æˆ·ç«¯å°è£…</p>
<p>Data Pipeline: æ•´ä¸ª flink cdc æ•°æ®æµç§°ä¸º pipelineï¼Œå†…éƒ¨åŒ…æ‹¬å¿…é¡»é…ç½®çš„ Data Source å’Œ Data Sinkï¼Œä»¥åŠå¯é€‰çš„ router</p>
<p>Pipeline Connector: æ”¯æŒ schema evolution çš„æ•°æ®æºï¼Œç›®å‰æœ‰ mysql ( <a target="_blank" rel="noopener" href="https://github.com/debezium/debezium">debezium</a> ) ã€ paimon ( <a target="_blank" rel="noopener" href="https://github.com/apache/paimon/tree/master/paimon-flink">paimon flink conector</a> ) ã€ kafka ( <a target="_blank" rel="noopener" href="https://github.com/apache/flink-connector-kafka">kafka flink connector</a> ) ã€doris ( <a target="_blank" rel="noopener" href="https://github.com/apache/doris-flink-connector">doris flink connector</a> ) ã€ starrocks ( <a target="_blank" rel="noopener" href="https://github.com/StarRocks/starrocks-connector-for-apache-flink">starrocks flink connector</a> ) å’Œ elasticsearch ( <a target="_blank" rel="noopener" href="https://github.com/apache/flink-connector-elasticsearch">elasticsearch flink connector</a> )</p>
<p>Source Connector: åŒ…æ‹¬ pipeline connector ä»¥åŠå…¶ä»–æš‚ä¸æ”¯æŒ pipeline çš„å…¶ä»–æ•°æ®æºï¼Œå¦‚ pgsql (debezium) å’Œ tidb ( <a target="_blank" rel="noopener" href="https://github.com/tikv/client-java">tikv client java</a> ) ç­‰ï¼Œå¯ç›´æ¥å¼•ç”¨æˆ–é€šè¿‡ flink sql ä½¿ç”¨</p>
<p>Data Source: æ•°æ®è¯»å–ç«¯å°è£…</p>
<p>Data Sink: æ•°æ®å†™å…¥ç«¯å°è£…</p>
<p>Table ID: æ ‡è¯†åŒæ­¥æ•°æ®æºæ—¶éœ€è¦æŒ‡å®šçš„è¡¨æ ‡è¯†ï¼Œå¦‚ mysql å°±æ˜¯è¡¨åï¼Œkafka å°±æ˜¯ topic</p>
<p>Transform: é€šè¿‡ SQL æˆ–è€… UDF æ³¨å…¥å­—æ®µè½¬æ¢çš„ç‰¹æ®Šé€»è¾‘</p>
<p>Route: è·¯ç”±ï¼Œæ”¯æŒè®¾ç½®ä¸åŒè¡¨åæ˜ å°„ã€å¤šè¡¨å¯¹å•è¡¨æ˜ å°„ç­‰</p>
<h2 id="ç¯å¢ƒå‡†å¤‡"><a href="#ç¯å¢ƒå‡†å¤‡" class="headerlink" title="ç¯å¢ƒå‡†å¤‡"></a>ç¯å¢ƒå‡†å¤‡</h2><p>éœ€è¦éƒ¨ç½²çš„ mysql, doris å’Œ flink éƒ½å¯ä»¥å•ç‚¹æ¨¡å¼è¿è¡Œï¼Œå› æ­¤æ¥ä¸‹æ¥çš„æ‰€æœ‰éƒ¨ç½²æ“ä½œéƒ½åœ¨ä¸€ä¸ª centos8 å®¹å™¨å†…æ‰§è¡Œ</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 3306: mysql</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 9030: doris fe</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 8081: flink web</span></span><br><span class="line">docker run -it -p 3306:3306 -p 9030:9030 -p 8081:8081 -d --name test_flink centos8</span><br></pre></td></tr></table></figure>

<h3 id="flink-local-singleton"><a href="#flink-local-singleton" class="headerlink" title="flink local singleton"></a>flink local singleton</h3><p>flink é€‰æ‹© 1.18 ç‰ˆæœ¬, æœ¬åœ°å¯åŠ¨ jobmanager å’Œ taskmanager</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½å®‰è£…åŒ…</span></span><br><span class="line">wget https://dlcdn.apache.org/flink/flink-1.18.1/flink-1.18.1-bin-scala_2.12.tgz</span><br><span class="line">tar -xvf flink-1.18.1-bin-scala_2.12.tgz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®é»˜è®¤é…ç½®</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> web ui port</span></span><br><span class="line">rest.port: 24001</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> web ui <span class="built_in">bind</span> address</span></span><br><span class="line">rest.bind-address: 0.0.0.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># å…¶ä»–å’Œå†…å­˜ç›¸å…³çš„é…ç½®ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒéœ€è¦è€ƒè™‘æ‰©å®¹çš„: taskmanager.memory.process.sizeã€jobmanager.memory.process.size ç­‰</span></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ jobmanager å’Œ taskmanager</span></span><br><span class="line"></span><br><span class="line">bash /opt/modules/flink/bin/jobmanager.sh start</span><br><span class="line">bash /opt/modules/flink/bin/taskmanager.sh start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œ wordcount example</span></span><br><span class="line">/opt/modules/flink/bin/flink run /opt/modules/flink/examples/batch/WordCount.jar</span><br></pre></td></tr></table></figure>

<h3 id="flink-cdc-3-0"><a href="#flink-cdc-3-0" class="headerlink" title="flink cdc 3.0"></a>flink cdc 3.0</h3><!--
3.0 ç‰ˆæœ¬åï¼Œcdc å¯ä»¥ç›´æ¥é€šè¿‡ï¼Œç›¸æ¯”ä¹‹å‰éœ€è¦é€šè¿‡ç±»ä¼¼ starrocks smt çš„å·¥å…·ç”Ÿæˆ flink sql ä»»åŠ¡çš„æ–¹å¼è¦æ–¹ä¾¿å¾ˆå¤š

å°¤å…¶æ˜¯ä½¿ç”¨å…·å¤‡ pipeline èƒ½åŠ›çš„æ•°æ®æºï¼Œæ”¯æŒåœ¨ä¸€ä¸ªä»»åŠ¡ä¸­é…ç½®å¤šä¸ªæ•°æ®åº“è¡¨ï¼Œé…ç½®èµ·æ¥æ›´åŠ æ–¹ä¾¿
-->

<p>3.0 ä¹‹åçš„ flink cdc å¯ä»¥ç›´æ¥é€šè¿‡å®ƒè‡ªå·±å°è£…çš„ Client æäº¤ä»»åŠ¡äº†ï¼Œå› æ­¤é™¤äº†å’Œ 2.4 åŒæ ·çš„è¦ä¸‹è½½æ•°æ®æºå¯¹åº”çš„ jar åŒ…å¤–ï¼Œè¿˜éœ€ç”¨åˆ°å®˜æ–¹æä¾›çš„å®¢æˆ·ç«¯</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä» release ä¸­ä¸‹è½½å¹¶å®‰è£… flink cdc</span></span><br><span class="line">wget https://dlcdn.apache.org/flink/flink-cdc-3.1.1/flink-cdc-3.1.1-bin.tar.gz</span><br><span class="line">tar -xzvf flink-cdc-3.1.1-bin.tar.gz</span><br><span class="line">mv flink-cdc-3.1.1 flink-cdc</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„: lib ä¸‹é¢åªæœ‰ cdc æœ¬èº«çš„ä¾èµ–ï¼Œæ•°æ®åº“ç›¸å…³çš„ä¾èµ–åŒ…éœ€è¦è‡ªè¡Œä¸‹è½½</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œåˆ›å»º flink jdbc connector çš„ä»»åŠ¡éœ€è¦ä»¥ä¸‹ä¾èµ–</span></span><br><span class="line">wget https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.30/mysql-connector-java-8.0.30.jar -O lib/mysql-connector-java-8.0.30.jar</span><br><span class="line"></span><br><span class="line">wget https://repo1.maven.org/maven2/org/apache/flink/flink-connector-jdbc/3.1.2-1.18/flink-connector-jdbc-3.1.2-1.18.jar -O lib/flink-connector-jdbc-3.1.2-1.18.jar</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è¿è¡Œä» mysql åŒæ­¥åˆ° doris çš„ CDC ä»»åŠ¡è¿˜éœ€è¦ä»¥ä¸‹ä¾èµ–</span></span><br><span class="line">wget https://repo.maven.apache.org/maven2/org/apache/flink/flink-cdc-pipeline-connector-mysql/3.1.1/flink-cdc-pipeline-connector-mysql-3.1.1.jar -O lib/flink-cdc-pipeline-connector-mysql-3.1.1.jar</span><br><span class="line"></span><br><span class="line">wget https://repo.maven.apache.org/maven2/org/apache/flink/flink-cdc-pipeline-connector-doris/3.1.1/flink-cdc-pipeline-connector-doris-3.1.1.jar -O lib/flink-cdc-pipeline-connector-doris-3.1.1.jar</span><br></pre></td></tr></table></figure>

<ul>
<li>æ³¨æ„: flink cdc çš„ç‰ˆæœ¬è¦å’Œ connector çš„ç‰ˆæœ¬å¯¹åº”ï¼Œå¦åˆ™å¯èƒ½ä¼šåœ¨æäº¤ä»»åŠ¡æ—¶æŠ¥ Cannot find factory with identifier â€œmysqlâ€ in the classpath</li>
</ul>
<!-- ç¼–è¯‘: mvn clean package -DskipTests -Dspotless.apply.skip -->

<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>è¿™é‡Œæˆ‘ä»¬éƒ¨ç½² 8.0.39 ç‰ˆæœ¬ï¼Œä½œä¸ºæ•°æ®æº</p>
<blockquote>
<p>æ³¨: ä¸€å¼€å§‹éƒ¨ç½² 8.4.3 æœ€æ–°ç‰ˆæœ¬ mysql ï¼Œå‘ç°è¯»å– binlog ä¿¡æ¯çš„ SHOW MASTER STATUS ç«Ÿç„¶æ‰§è¡Œä¸äº†ï¼Œæ›¿æ¢æˆäº† SHOW BINARY LOG STATUS ï¼Œè€Œ flink cdc è¿˜æ²¡æœ‰åšé€‚é…ï¼Œå› æ­¤åªèƒ½æŠŠ mysql å›é€€é‡è£…äº†ã€‚çœ‹æ¥ä»€ä¹ˆéƒ½ç”¨ç¤¾åŒºæœ€æ–°ç‰ˆè¿˜æ˜¯æœ‰ä¸€äº›è¸©å‘çš„é£é™©çš„ğŸ˜‚</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ä»å®˜ç½‘ä¸‹è½½å®‰è£…åŒ…ï¼Œæ³¨æ„ä¸‹è½½é€‚é…ç³»ç»Ÿæ¶æ„çš„ç‰ˆæœ¬</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://dev.mysql.com/downloads/mysql</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„: ç³»ç»Ÿè‹¥å·²æœ‰ mariadb ç›¸å…³çš„å®‰è£…åŒ…ï¼Œå®‰è£…ä¼šæŠ¥å†²çªï¼Œéœ€è¦å…ˆå¸è½½ mariadb ç›¸å…³åŒ…</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½ arm çš„ mysql å®˜æ–¹å®‰è£…åŒ…</span></span><br><span class="line"></span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-common-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-community-client-plugins-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-community-libs-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-community-client-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-community-icu-data-files-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.0/mysql-community-server-8.0.39-1.el8.aarch64.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> x86</span></span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-common-8.0.39-1.el8.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-client-plugins-8.0.39-1.el8.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-libs-8.0.39-1.el8.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-client-8.0.39-1.el8.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-icu-data-files-8.0.39-1.el8.x86_64.rpm</span><br><span class="line">wget https://dev.mysql.com/get/Downloads/MySQL-8.4/mysql-community-server-8.0.39-1.el8.x86_64.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å®‰è£…</span></span><br><span class="line">rpm -ivh mysql-community-common-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-plugins-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">rpm -ivh mysql-community-libs-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">rpm -ivh mysql-community-client-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">rpm -ivh mysql-community-icu-data-files-8.0.39-1.el8.aarch64.rpm</span><br><span class="line">rpm -ivh mysql-community-server-8.0.39-1.el8.aarch64.rpm</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆå§‹åŒ–ã€é¦–æ¬¡å¯åŠ¨ mysql</span></span><br><span class="line">mysqld --initialize</span><br><span class="line">mysqld --user=root</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä» /var/<span class="built_in">log</span>/mysqld.log ä¸­è·å¾— mysql åˆå§‹å¯†ç </span></span><br><span class="line">cat /var/log/mysqld.log | grep &quot;A temporary password&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä»å¦ä¸€ä¸ªçª—å£ç™»å½• mysql</span></span><br><span class="line">mysql -h127.0.0.1 -P3306 -uroot -p&#123;mysqlåˆå§‹å¯†ç &#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ root å¯†ç </span></span><br><span class="line">SET PASSWORD = &#x27;&#123;mysqlå¯†ç &#125;&#x27;;</span><br></pre></td></tr></table></figure>

<h3 id="doris"><a href="#doris" class="headerlink" title="doris"></a>doris</h3><p><a target="_blank" rel="noopener" href="https://doris.apache.org/docs/dev/gettingStarted/what-is-apache-doris">doris</a> æ˜¯ä¸€ä¸ªå…·å¤‡é«˜æ€§èƒ½å®æ—¶è®¡ç®—å’ŒæŸ¥è¯¢æ€§èƒ½çš„OLAPæ•°æ®åº“ï¼Œç»å¸¸ç”¨äºä»ä¸šåŠ¡æ•°æ®åº“å®æ—¶åŒæ­¥æ•°æ®åï¼Œè¿›è¡Œæµ·é‡æ•°æ®åˆ†æã€é«˜å¹¶å‘å³å¸­æŸ¥è¯¢ã€æ—¥å¿—åˆ†æã€ç”¨æˆ·ç”»åƒåˆ†æç­‰ã€‚åœ¨ä¼ä¸šå†…æœ€å¸¸ç”¨çš„åœºæ™¯æ˜¯åˆ¶ä½œå„ç§ä¸šåŠ¡æŠ¥è¡¨ï¼Œæä¾›ç»™æ•°æ®åˆ†æå¸ˆå’Œç®¡ç†è€…ã€‚ç›¸å…³æŠ€æœ¯ä¸»è¦æœ‰å­˜å‚¨æ¨¡å‹ã€ç‰©åŒ–è§†å›¾ã€å‘é‡åŒ–å¼•æ“ã€CBOä¼˜åŒ–ç­‰</p>
<p>doris çš„åŸºæœ¬ç»„ä»¶ä¸º fe å’Œ beï¼Œfe è´Ÿè´£ç®¡ç†é›†ç¾¤ï¼Œæ¥æ”¶å’Œå¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œåˆ†æå¹¶å¾—åˆ°SQLæ‰§è¡Œè®¡åˆ’ï¼Œbe è´Ÿè´£æ•°æ®å­˜å‚¨å’ŒSQLçš„å…·ä½“è®¡ç®—é€»è¾‘æ‰§è¡Œ</p>
<p><img src="/2024/06/19/flink-cdc-3.0/doris-01.png" alt="doris structure"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> doris 3.0 ç‰ˆæœ¬éœ€è¦ç”¨ jdk 17</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> adoptium ç‰ˆæœ¬çš„å¼€æº openjdk å¯ä»¥ä»è¿™é‡Œä¸‹è½½</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://github.com/adoptium/temurin17-binaries/releases</span></span><br><span class="line"></span><br><span class="line">wget https://github.com/adoptium/temurin17-binaries/releases/download/jdk-17.0.9%2B9/OpenJDK17U-jdk_aarch64_linux_hotspot_17.0.9_9.tar.gz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> è®¾ç½®ç¯å¢ƒå˜é‡</span></span><br><span class="line">export JAVA_HOME=/opt/modules/java/jdk-17.0.9+9</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¸‹è½½ doris</span></span><br><span class="line">wget https://apache-doris-releases.oss-accelerate.aliyuncs.com/apache-doris-3.0.2-bin-arm64.tar.gz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹é…ç½®</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fe: http_port: frontend ç•Œé¢åœ°å€ï¼Œé»˜è®¤ 9030</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> fe: meta_dir: frontend å…ƒæ•°æ®å­˜å‚¨è·¯å¾„</span></span><br><span class="line">vim /opt/modules/doris/fe/conf/fe.conf</span><br><span class="line"></span><br><span class="line">meta_dir = /opt/modules/doris/fe/meta</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> be: storage_root_path: å­˜å‚¨è·¯å¾„</span></span><br><span class="line">vim /opt/modules/doris/be/conf/be.conf</span><br><span class="line">storage_root_path = /opt/modules/doris/be/data</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ fe</span></span><br><span class="line">mkdir -p /opt/modules/doris/fe/meta</span><br><span class="line">/opt/modules/doris/fe/bin/start_fe.sh --daemon</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">tail -f /opt/modules/doris/fe/log/fe.log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨ be</span></span><br><span class="line">mkdir -p /opt/modules/doris/be/data</span><br><span class="line">/opt/modules/doris/be/bin/start_be.sh --daemon</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> æŸ¥çœ‹å¯åŠ¨æ—¥å¿—</span></span><br><span class="line">tail -f /opt/modules/doris/be/log/be.INFO</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> å¯åŠ¨åï¼Œé¦–æ¬¡ç™»å½• fe ä¸éœ€è¦å¯†ç ï¼Œè®¾ç½® root å¯†ç å¹¶æ·»åŠ  be</span></span><br><span class="line">mysql -h127.0.0.1 -P9030 -uroot</span><br><span class="line"></span><br><span class="line">SET PASSWORD FOR &#x27;root&#x27; = PASSWORD(&#x27;&#123;Doriså¯†ç &#125;&#x27;);</span><br><span class="line"></span><br><span class="line">ALTER SYSTEM ADD BACKEND &quot;localhost:9050&quot;;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨: å®¹å™¨å†…å¯åŠ¨å¯èƒ½ä¼šé‡åˆ°æŠ¥é”™ Please set vm.max_map_count to be 2000000 under root using â€˜sysctl -w vm.max_map_count=2000000â€™ ï¼Œä¸ºäº†æµ‹è¯•å¯ä»¥å…ˆæ³¨é‡Šæ‰è¿™æ®µåˆ¤æ–­é€»è¾‘ï¼Œåœ¨ /opt/modules/doris/be/bin/start_be.sh ä¸­</p>
</blockquote>
<h2 id="ä»»åŠ¡é…ç½®ä¸è¿è¡Œ"><a href="#ä»»åŠ¡é…ç½®ä¸è¿è¡Œ" class="headerlink" title="ä»»åŠ¡é…ç½®ä¸è¿è¡Œ"></a>ä»»åŠ¡é…ç½®ä¸è¿è¡Œ</h2><p>å‰é¢çš„ç¯å¢ƒå®‰è£…éƒ½æ˜¯ä¸ºäº†è¿™é‡Œçš„ä»»åŠ¡è¿è¡Œåšé“ºå«</p>
<h3 id="mysql-æ¨¡æ‹Ÿè¡¨"><a href="#mysql-æ¨¡æ‹Ÿè¡¨" class="headerlink" title="mysql æ¨¡æ‹Ÿè¡¨"></a>mysql æ¨¡æ‹Ÿè¡¨</h3><p>åœ¨ mysql åˆ›å»ºä¸€å¼ â€œä¸šåŠ¡â€è¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ä¸“è¾‘</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `d_music`.`album` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `album_artist` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  `<span class="keyword">year</span>` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">  `song_count` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span></span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">) ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>


<h3 id="é€šè¿‡-dagagen-å®æ—¶å‘-mysql-å†™å…¥æ•°æ®"><a href="#é€šè¿‡-dagagen-å®æ—¶å‘-mysql-å†™å…¥æ•°æ®" class="headerlink" title="é€šè¿‡ dagagen å®æ—¶å‘ mysql å†™å…¥æ•°æ®"></a>é€šè¿‡ dagagen å®æ—¶å‘ mysql å†™å…¥æ•°æ®</h3><p><a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-master/docs/dev/python/table/python_table_api_connectors">flink connector</a> æ•°æ®æºæœ‰å„ç§è¿æ¥å™¨ï¼Œå…¶ä¸­ <a target="_blank" rel="noopener" href="https://nightlies.apache.org/flink/flink-docs-master/docs/connectors/table/datagen">datagen</a> æ˜¯å¯ä»¥éšæœºç”Ÿæˆæ•°æ®çš„ connector</p>
<p>é’ˆå¯¹åˆšæ‰ mysql åˆ›å»ºçš„æµ‹è¯•è¡¨ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå®šæ—¶å†™å…¥æ•°æ®çš„ä»»åŠ¡:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- /opt/modules/flink/album.sql</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> album_datagen (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    album_artist STRING,</span><br><span class="line">    `<span class="keyword">year</span>` <span class="type">INT</span>,</span><br><span class="line">    song_count <span class="type">INT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;datagen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rows-per-second&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> album_mysql (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    album_artist STRING,</span><br><span class="line">    `<span class="keyword">year</span>` <span class="type">INT</span>,</span><br><span class="line">    song_count <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id) <span class="keyword">NOT</span> ENFORCED</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/d_music&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;&#123;mysqlå¯†ç &#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;album&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `album_mysql` <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> album_datagen;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨: è¿™é‡Œ flink sql çš„è¡¨æ²¡æœ‰è®¾ç½® create_time å­—æ®µï¼Œä¸ºäº†è®©å…¶èƒ½ä½¿ç”¨ mysql è¡¨çš„é»˜è®¤å€¼</p>
</blockquote>
<blockquote>
<p>æ³¨: rows-per-second é…ç½®ä¸ºdatagenæ¯ç§’äº§ç”Ÿçš„æ•°æ®é‡ï¼Œé»˜è®¤ä¸º1w</p>
</blockquote>
<p>æäº¤ flink sql:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/opt/modules/flink/bin/sql-client.sh -f /opt/modules/flink/album.sql</span><br></pre></td></tr></table></figure>

<p>æäº¤åå¯ä»¥åœ¨ flink ç•Œé¢çœ‹åˆ° datagen ä»»åŠ¡æ­£å¸¸è¿è¡Œï¼Œå¹¶åœ¨ mysql ä¸­æŸ¥è¯¢åˆ°æ¯ç§’å†™å…¥çš„éšæœºæ•°æ®</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -hlocalhost -P3306 -uroot -p<span class="string">&#x27;&#123;mysqlå¯†ç &#125;&#x27;</span> -e <span class="string">&quot;select * from d_music.artist order by create_time desc limit 10&quot;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2024/06/19/flink-cdc-3.0/flink-datagen-01.png" alt="flink datagen job"></p>
<p><img src="/2024/06/19/flink-cdc-3.0/flink-datagen-02.png" alt="flink datagen data"></p>
<h3 id="flink-cdc-ä»»åŠ¡é…ç½®ä¸æäº¤"><a href="#flink-cdc-ä»»åŠ¡é…ç½®ä¸æäº¤" class="headerlink" title="flink cdc ä»»åŠ¡é…ç½®ä¸æäº¤"></a>flink cdc ä»»åŠ¡é…ç½®ä¸æäº¤</h3><p>æŒ‰ç…§å®˜æ–¹æ•™ç¨‹ï¼Œä¿®æ”¹ mysql åœ°å€å’Œ doris åœ°å€ã€éœ€è¦åŒæ­¥çš„åº“è¡¨å³å¯</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /opt/modules/flink-cdc/album.yaml</span></span><br><span class="line"><span class="attr">source:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">mysql</span></span><br><span class="line">  <span class="attr">hostname:</span> <span class="string">localhost</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">3306</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> &#123;<span class="string">mysqlå¯†ç </span>&#125;</span><br><span class="line">  <span class="attr">tables:</span> <span class="string">d_music.album</span></span><br><span class="line">  <span class="attr">scan.incremental.snapshot.chunk.size:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">scan.snapshot.fetch.size:</span> <span class="number">1000</span></span><br><span class="line">  <span class="attr">scan.startup.mode:</span> <span class="string">initial</span></span><br><span class="line">  <span class="attr">server-time-zone:</span> <span class="string">UTC+8</span></span><br><span class="line"></span><br><span class="line"><span class="attr">sink:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">doris</span></span><br><span class="line">  <span class="attr">fenodes:</span> <span class="string">localhost:8030</span></span><br><span class="line">  <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">  <span class="attr">password:</span> &#123;<span class="string">doriså¯†ç </span>&#125;</span><br><span class="line">  <span class="attr">table.create.properties.light_schema_change:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">table.create.properties.replication_num:</span> <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="attr">pipeline:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">sr_cdc_sink_doris_example</span></span><br><span class="line">  <span class="attr">parallelism:</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>æ³¨: è‹¥ä»»åŠ¡è¿è¡Œçš„æœ¬åœ°æ—¶åŒºå’Œ mysql æœåŠ¡å™¨æ—¶åŒºä¸ä¸€è‡´ï¼Œserver-time-zone éœ€è¦æŒ‡å®šä¸ºæœ¬åœ°æ—¶åŒº</p>
</blockquote>
<blockquote>
<p>æ³¨: fenodes å¯¹åº” doris fe çš„ http_port</p>
</blockquote>
<blockquote>
<p>æ³¨: scan.startup.mode: ç±»ä¼¼ canal çš„åŒæ­¥æ¨¡å¼é…ç½®ï¼Œinitial è¡¨ç¤ºä»å¤´åŒæ­¥æ‰€æœ‰æ•°æ®ï¼Œè¿˜æ”¯æŒä»æŒ‡å®šæ—¶é—´æˆ³åŒæ­¥</p>
</blockquote>
<p>ç„¶åæˆ‘ä»¬æäº¤è¿™ä¸ªä»»åŠ¡, æ­£å¸¸ç­‰å¾…ä¸ªå‡ ç§’ï¼Œåœ¨ doris å°±èƒ½æŸ¥åˆ°ä» mysql åŒæ­¥è¿‡æ¥çš„æ•°æ®äº†</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ³¨æ„éœ€è¦æ˜¾å¼å£°æ˜ FLINK_HOME å³ flink å®‰è£…è·¯å¾„ï¼Œåœ¨ flink-cdc.sh è„šæœ¬ä¸­ç”¨åˆ°</span></span><br><span class="line">export FLINK_HOME=/opt/modules/flink</span><br><span class="line"></span><br><span class="line">/opt/modules/flink-cdc/bin/flink-cdc.sh /opt/modules/flink-cdc/album.yaml</span><br></pre></td></tr></table></figure>

<p><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-job-01.png" alt="flink cdc job"></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥è¯¢ doris æœ€è¿‘å†™å…¥çš„æ•°æ®</span></span><br><span class="line">mysql <span class="operator">-</span>h127<span class="number">.0</span><span class="number">.0</span><span class="number">.1</span> <span class="operator">-</span>P9030 <span class="operator">-</span>uroot <span class="operator">-</span>p&#123;Doriså¯†ç &#125; <span class="operator">-</span>e &quot;select * from d_music.album order by create_time desc limit 10&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-job-02.png" alt="flink cdc job"></p>
<p>æˆ‘ä»¬è¿˜èƒ½å‘ç°ï¼ŒDoris è¿™è¾¹æ˜¯ä¸éœ€è¦æå‰å»ºè¡¨çš„ï¼Œflink cdc å·²ç»å¸®æˆ‘ä»¬å»ºå¥½äº†ä¸€å¼ ä¸»é”®è¡¨ï¼Œå…¶ä¸­å‰¯æœ¬æ•°ä¹‹ç±»çš„åŸºæœ¬é…ç½®æ ¹æ®cdc ä»»åŠ¡ä¸­çš„ table.create.properties.replication_num æ¥è®¾ç½®</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> d_music.album;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `album` (</span><br><span class="line">  `id` <span class="type">varchar</span>(<span class="number">765</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `create_time` datetime <span class="keyword">NULL</span>,</span><br><span class="line">  `name` <span class="type">varchar</span>(<span class="number">765</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `album_artist` <span class="type">varchar</span>(<span class="number">765</span>) <span class="keyword">NULL</span>,</span><br><span class="line">  `<span class="keyword">year</span>` <span class="type">int</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `song_count` <span class="type">int</span> <span class="keyword">NULL</span></span><br><span class="line">) ENGINE<span class="operator">=</span>OLAP</span><br><span class="line"><span class="keyword">UNIQUE</span> KEY(`id`)</span><br><span class="line">DISTRIBUTED <span class="keyword">BY</span> HASH(`id`) BUCKETS AUTO</span><br><span class="line">PROPERTIES (</span><br><span class="line">&quot;replication_allocation&quot; <span class="operator">=</span> &quot;tag.location.default: 1&quot;,</span><br><span class="line">&quot;min_load_replica_num&quot; <span class="operator">=</span> &quot;-1&quot;,</span><br><span class="line">&quot;is_being_synced&quot; <span class="operator">=</span> &quot;false&quot;,</span><br><span class="line">&quot;storage_medium&quot; <span class="operator">=</span> &quot;hdd&quot;,</span><br><span class="line">&quot;storage_format&quot; <span class="operator">=</span> &quot;V2&quot;,</span><br><span class="line">&quot;inverted_index_storage_format&quot; <span class="operator">=</span> &quot;V2&quot;,</span><br><span class="line">&quot;enable_unique_key_merge_on_write&quot; <span class="operator">=</span> &quot;true&quot;,</span><br><span class="line">&quot;light_schema_change&quot; <span class="operator">=</span> &quot;true&quot;,</span><br><span class="line">&quot;disable_auto_compaction&quot; <span class="operator">=</span> &quot;false&quot;,</span><br><span class="line">&quot;enable_single_replica_compaction&quot; <span class="operator">=</span> &quot;false&quot;,</span><br><span class="line">&quot;group_commit_interval_ms&quot; <span class="operator">=</span> &quot;10000&quot;,</span><br><span class="line">&quot;group_commit_data_bytes&quot; <span class="operator">=</span> &quot;134217728&quot;,</span><br><span class="line">&quot;enable_mow_light_delete&quot; <span class="operator">=</span> &quot;false&quot;</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>å½“ç„¶ï¼Œé™¤äº†ä¸»é”®æ¨¡å‹ï¼Œdoris è¿˜æ”¯æŒèšåˆæ¨¡å‹(Aggregate)å’Œæ˜ç»†æ¨¡å‹(Duplicate)è¡¨ï¼Œå‚è€ƒ <a target="_blank" rel="noopener" href="https://doris.apache.org/docs/dev/table-design/data-model/overview">data models</a>ã€‚ä½†æ˜¯ flink cdc å¯¹äºåŒæ­¥æºè¡¨ä¸­ä¸»é”®çš„è¡¨ï¼Œä¼šé»˜è®¤åˆ›å»ºä¸»é”®æ¨¡å‹è¡¨ã€‚å› æ­¤æœ‰åˆ›å»ºå…¶ä»–æ¨¡å‹è¡¨çš„è¯å°±éœ€è¦æå‰å»ºäº†</p>
<p>å…³äº flink cdc å®ç°æå‰å»ºè¡¨å’Œ schema evolution çš„å®ç°å¯ä»¥å‚è€ƒå¯¹å„ä¸ªæ•°æ®æºçš„ MetadataApplier å®ç°ï¼Œå¦‚ <a target="_blank" rel="noopener" href="https://github.com/apache/flink-cdc/blob/master/flink-cdc-connect/flink-cdc-pipeline-connectors/flink-cdc-pipeline-connector-doris/src/main/java/org/apache/flink/cdc/connectors/doris/sink/DorisMetadataApplier.java">DorisMetadataApplier</a></p>
<h3 id="schema-evolution"><a href="#schema-evolution" class="headerlink" title="schema evolution"></a>schema evolution</h3><p>é“ºå«äº†è¿™ä¹ˆä¹…ï¼Œç»ˆäºæ¥åˆ°äº†æµ‹è¯•è¡¨ç»“æ„å˜æ›´åŒæ­¥çš„ç¯èŠ‚</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> æ·»åŠ å­—æ®µ</span></span><br><span class="line">mysql -hlocalhost -P3306 -uroot -p&#x27;&#123;mysqlå¯†ç &#125;&#x27; -e &quot;ALTER TABLE d_music.album ADD COLUMN duration DOUBLE AFTER song_count&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹åç¡®è®¤ doris è¡¨ç»“æ„æ˜¯å¦æ›´æ–°</span></span><br><span class="line">mysql -h127.0.0.1 -P9030 -uroot -p&#123;doriså¯†ç &#125; -e &quot;show create table d_music.album&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> ä¿®æ”¹ mysql å­—æ®µåç§°</span></span><br><span class="line">mysql -hlocalhost -P3306 -uroot -p&#x27;&#123;mysqlå¯†ç &#125;&#x27; -e &quot;ALTER TABLE d_music.album RENAME COLUMN duration TO duration_total&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> åˆ é™¤ mysql å­—æ®µ</span></span><br><span class="line">mysql -hlocalhost -P3306 -uroot -p&#x27;&#123;mysqlå¯†ç &#125;&#x27; -e &quot;ALTER TABLE d_music.album DROP COLUMN duration_total&quot;</span><br></pre></td></tr></table></figure>

<p>ä» flink taskmanager æ—¥å¿—ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¡¨ç»“æ„å˜æ›´æ—¶ï¼Œä¼šè§¦å‘ SchemaChangeEvent äº‹ä»¶ï¼Œåç»­çš„å…¶ä»–æ•°æ®å†™å…¥æˆ–å˜æ›´æ“ä½œéƒ½å¿…é¡»ç­‰å¾…å½“å‰çš„ schema change å®Œæˆåæ‰ä¼šç»§ç»­è¿›è¡Œï¼Œä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§</p>
<p><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-job-03.png" alt="flink taskmanager log"></p>
<blockquote>
<p>æ³¨: è¡¨å­—æ®µç±»å‹å˜æ›´çš„åŒæ­¥åœ¨ <a target="_blank" rel="noopener" href="https://github.com/apache/flink-cdc/blob/release-3.2.0/flink-cdc-connect/flink-cdc-pipeline-connectors/flink-cdc-pipeline-connector-doris/src/main/java/org/apache/flink/cdc/connectors/doris/sink/DorisMetadataApplier.java#L112">3.2.0</a> ç‰ˆæœ¬ä¹‹åæ‰æ”¯æŒï¼Œæœ¬æ–‡æ‰€ç”¨çš„ 3.1 ä¸æ”¯æŒ</p>
</blockquote>
<blockquote>
<p>æ³¨: ä¸åŒæ•°æ®æºå¯¹å­—æ®µå˜æ›´çš„é€‚é…å®Œå–„ç¨‹åº¦æœ‰æ‰€ä¸åŒï¼Œå¦‚ Doris åœ¨ cdc æœ€æ–°ç‰ˆæ”¯æŒå­—æ®µç±»å‹å˜æ›´ï¼Œä½† <a target="_blank" rel="noopener" href="https://github.com/apache/flink-cdc/blob/release-3.2/flink-cdc-connect/flink-cdc-pipeline-connectors/flink-cdc-pipeline-connector-starrocks/src/main/java/org/apache/flink/cdc/connectors/starrocks/sink/StarRocksMetadataApplier.java#L292-L301">Starrocks</a> è¿˜ä¸æ”¯æŒ</p>
</blockquote>
<h3 id="æ•´åº“åŒæ­¥"><a href="#æ•´åº“åŒæ­¥" class="headerlink" title="æ•´åº“åŒæ­¥"></a>æ•´åº“åŒæ­¥</h3><p>æˆ‘ä»¬åœ¨ mysql ä¸­å†åˆ›å»ºä¸¤å¼ è¡¨</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> d_music.artist</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `create_time` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    `album_count` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br><span class="line"></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> d_music.playlist</span><br><span class="line">(</span><br><span class="line">    `id` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">    `create_time` datetime <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">    `name` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    `comment` <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    `song_count` <span class="type">int</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="string">&#x27;0&#x27;</span>,</span><br><span class="line">    <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">)ENGINE<span class="operator">=</span>InnoDB <span class="keyword">DEFAULT</span> CHARSET<span class="operator">=</span>utf8mb4;</span><br></pre></td></tr></table></figure>

<p>å¯¹åº”çš„ï¼Œæˆ‘ä»¬åœ¨ flink ä¹Ÿå†æäº¤è¿™ä¸¤å¼ æ–°è¡¨çš„ datagen</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> artist_datagen (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    album_count <span class="type">INT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;datagen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rows-per-second&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> TEMPORARY <span class="keyword">TABLE</span> playlist_datagen (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    `comment` STRING,</span><br><span class="line">    song_count <span class="type">INT</span></span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">    <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;datagen&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;rows-per-second&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> artist_mysql (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    album_count <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id) <span class="keyword">NOT</span> ENFORCED</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/d_music&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;&#123;mysqlå¯†ç &#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;artist&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> playlist_mysql (</span><br><span class="line">    id STRING,</span><br><span class="line">    name STRING,</span><br><span class="line">    `comment` STRING,</span><br><span class="line">    song_count <span class="type">INT</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (id) <span class="keyword">NOT</span> ENFORCED</span><br><span class="line">) <span class="keyword">WITH</span> (</span><br><span class="line">   <span class="string">&#x27;connector&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;url&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;jdbc:mysql://localhost:3306/d_music&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;username&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;password&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;&#123;mysqlå¯†ç &#125;&#x27;</span>,</span><br><span class="line">   <span class="string">&#x27;table-name&#x27;</span> <span class="operator">=</span> <span class="string">&#x27;playlist&#x27;</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `artist_mysql` <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> artist_datagen;</span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> `playlist_mysql` <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> playlist_datagen;</span><br></pre></td></tr></table></figure>

<p>æœ€åæˆ‘ä»¬å†æäº¤åŒæ­¥è¿™ä¸‰å¼ è¡¨ flink cdc ï¼Œç›¸æ¯”åˆšæ‰åŒæ­¥ä¸€å¼ è¡¨çš„é…ç½®åªéœ€è¦ä¿®æ”¹ tablesï¼ŒæŒ‰ç…§æ­£åˆ™è¡¨è¾¾å¼é…ç½®å³å¯ã€‚ä» <a target="_blank" rel="noopener" href="https://github.com/apache/flink-cdc/blob/master/flink-cdc-connect/flink-cdc-pipeline-connectors/flink-cdc-pipeline-connector-mysql/src/main/java/org/apache/flink/cdc/connectors/mysql/factory/MySqlDataSourceFactory.java">MySqlDataSourceFactory</a> å¯ä»¥æ‰¾åˆ°å¯¹ tables é…ç½®çš„è§£æé€»è¾‘</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># /opt/modules/flink-cdc/album.yaml</span></span><br><span class="line">  <span class="attr">tables:</span> <span class="string">d_music.\.*</span></span><br></pre></td></tr></table></figure>

<p>æäº¤æ‰€æœ‰ä»»åŠ¡åï¼Œflink ä¸Šå°†ä¼šæœ‰å››ä¸ªä»»åŠ¡ï¼Œä¸‰ä¸ª datagen å¯¹åº”ä¸‰å¼ è¡¨ï¼Œè€Œ flink cdc å¯¹åº”çš„æ‰€æœ‰è¡¨éƒ½åœ¨ä¸€ä¸ªä»»åŠ¡ä¸­åŒæ­¥</p>
<p><img src="/2024/06/19/flink-cdc-3.0/flink-cdc-job-04.png" alt="flink cdc all job"></p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥æ³¨æ„ mysql çš„è¿æ¥æ•°: å’Œ 2.4 ç‰ˆæœ¬å¯¹æ¯”ï¼Œè¿™æ¬¡ä¸€æ•´ä¸ªä»»åŠ¡åªéœ€è¦ä¸€ä¸ªè¿æ¥ï¼Œå…¶è¯»å– binlog ä¼šè‡ªåŠ¨è§£æç»™å¯¹åº”è¡¨çš„åŒæ­¥ï¼Œè€Œä¸éœ€è¦æ¯å¼ è¡¨éƒ½åˆ›å»ºä¸€ä¸ªè¿æ¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- æŸ¥çœ‹ mysql è¯»å– binlog ç›¸å…³çš„è¿æ¥æ•°</span></span><br><span class="line">mysql <span class="operator">-</span>hlocalhost <span class="operator">-</span>P3306 <span class="operator">-</span>uroot <span class="operator">-</span>p<span class="string">&#x27;&#123;mysqlå¯†ç &#125;&#x27;</span> <span class="operator">-</span>e &quot;show processlist&quot; <span class="operator">|</span> grep &quot;Binlog Dump&quot;</span><br></pre></td></tr></table></figure>

<p>ä½†æ³¨æ„: æœ‰å“ªäº›è¡¨éœ€è¦åŒæ­¥ï¼Œæ˜¯ä»»åŠ¡åœ¨åˆ›å»ºçš„æ—¶å€™å°±è§£æçš„ï¼Œåç»­æºåº“å†æ·»åŠ è¡¨ï¼Œä¸ä¼šè®©ç°æœ‰çš„ä»»åŠ¡æŠŠè¿™ä¸ªæ–°è¡¨ä¹ŸåŠ å…¥åŒæ­¥</p>
<!--
### æ‰©å±•: åŒæ­¥ tidb

[ä½¿ç”¨æœ€æ–°ç‰ˆflink tidb cdc åŒæ­¥æ•°æ®åˆ°StarRocks](https://blog.csdn.net/gongxiucheng/article/details/124281253)

æˆªæ­¢ç›®å‰ tidb è¿˜ä¸æ”¯æŒ pipeline è¿æ¥å™¨ - [mysql](https://nightlies.apache.org/flink/flink-cdc-docs-release-3.1/zh/docs/connectors/pipeline-connectors/mysql)
-->

<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>3.0 ä¹‹åçš„ cdc åœ¨åŠŸèƒ½ä¸Šæ›´åŠ æˆç†Ÿï¼Œä¸ä»…æ˜¯æ¶æ„æ›´æ¸…æ¥šï¼Œé€šè¿‡ yaml é…ç½® cdc ä»»åŠ¡çš„æ–¹å¼ä¹Ÿæ›´ç®€åŒ–ï¼Œå’Œ flink æœ¬èº«æ›´ç»Ÿä¸€äº†</p>
<p>ä¸è¿‡ä»æ•´ä¸ªè¿‡ç¨‹ä¹Ÿèƒ½çœ‹åˆ°ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒé¢å¯¹å¤§é‡ä¸šåŠ¡è¡¨éœ€è¦åŒæ­¥çš„æ—¶å€™ï¼Œå…ˆä¸è¯´ä»»åŠ¡æ€ä¹ˆåšå¥½ç›‘æ§ï¼Œæœ¬èº«ä»»åŠ¡è¦åšåˆ°é«˜å¯ç”¨å°±å¿…é¡»æŠŠ checkpoint æ‰“å¼€ï¼Œå¦å¤–ï¼Œä¸æ˜¯æ‰€æœ‰ mysql çš„è¡¨ç»“æ„å˜æ›´éƒ½èƒ½æˆåŠŸåŒæ­¥åˆ°ä¸‹æ¸¸ï¼Œé¢å¯¹æ— æ³•åŒæ­¥çš„ç‰¹æ®Šæƒ…å†µï¼Œè¿˜éœ€è¦æ‰‹åŠ¨è®¾ç½®æŒ‡å®šåŒæ­¥æ—¶é—´ç‚¹æ¢å¤ä»»åŠ¡ï¼Œä¸€äº›ç¹ççš„ç»´æŠ¤è¿‡ç¨‹è¿˜æ˜¯æ— æ³•é¿å…</p>
<p>åç»­æœ‰æœºä¼šå†æ¢ç´¢ä¸€ä¸‹è¿™äº›ä¼˜åŒ–çš„æ€è·¯å§</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">æ–‡ç« ä½œè€…: </span><span class="post-copyright-info"><a href="mailto:xxx@gmail.com">smiecj</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">æ–‡ç« é“¾æ¥: </span><span class="post-copyright-info"><a href="http://smiecj.github.io/2024/06/19/flink-cdc-3.0/">http://smiecj.github.io/2024/06/19/flink-cdc-3.0/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">ç‰ˆæƒå£°æ˜: </span><span class="post-copyright-info">æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª <a href="http://smiecj.github.io" target="_blank">Smiecjçš„å°çª</a>ï¼</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/">å¤§æ•°æ®</a><a class="post-meta__tags" href="/tags/flink/">flink</a><a class="post-meta__tags" href="/tags/doris/">doris</a></div><div class="post_share"><div class="social-share" data-image="/2024/06/19/flink-cdc-3.0/cover.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/10/06/cloudflare-zero-trust/"><img class="prev-cover" src="https://image.winudf.com/v2/image1/Y29tLnNhbmdmb3IudnBuLmNsaWVudC50YWJsZXRfc2NyZWVuXzBfMTU2NzAxNjA3M18wNjE" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">ä¸Šä¸€ç¯‡</div><div class="prev_info">Cloudflare Zero Trust é…ç½®å†…ç½‘ç©¿é€</div></div></a></div><div class="next-post pull-right"><a href="/2024/04/25/azkaban-tools/"><img class="next-cover" src="/img/blog_img/azkaban.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">ä¸‹ä¸€ç¯‡</div><div class="next_info">azkaban-tools é¡¹ç›®ä»‹ç»</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> ç›¸å…³æ¨è</span></div><div class="relatedPosts-list"><div><a href="/2024/04/25/azkaban-tools/" title="azkaban-tools é¡¹ç›®ä»‹ç»"><img class="cover" src="/img/blog_img/azkaban.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2024-04-25</div><div class="title">azkaban-tools é¡¹ç›®ä»‹ç»</div></div></a></div><div><a href="/2022/08/13/dockerfile-compose-hdfs/" title="é€šè¿‡ Docker Compose æœ¬åœ°å¯åŠ¨ hadoop é›†ç¾¤"><img class="cover" src="/img/blog_img/hadoop.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2022-08-13</div><div class="title">é€šè¿‡ Docker Compose æœ¬åœ°å¯åŠ¨ hadoop é›†ç¾¤</div></div></a></div><div><a href="/2023/06/10/emr-es-to-hive/" title="ESæ•°æ®åŒæ­¥åˆ°hive"><img class="cover" src="/img/blog_img/es-to-hive.jpeg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-06-10</div><div class="title">ESæ•°æ®åŒæ­¥åˆ°hive</div></div></a></div><div><a href="/2023/10/31/emr-mongo-to-hive/" title="mongodbæ•°æ®åŒæ­¥åˆ°hive"><img class="cover" src="/2023/10/31/emr-mongo-to-hive/mongo.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-31</div><div class="title">mongodbæ•°æ®åŒæ­¥åˆ°hive</div></div></a></div><div><a href="/2023/04/30/emr-scheduler/" title="å¤§æ•°æ®ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®åŒæ­¥ç»„ä»¶åˆæ¢"><img class="cover" src="/img/blog_img/emr.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-30</div><div class="title">å¤§æ•°æ®ä»»åŠ¡è°ƒåº¦å’Œæ•°æ®åŒæ­¥ç»„ä»¶åˆæ¢</div></div></a></div><div><a href="/2023/08/23/opensource-monthly-202308/" title="å¼€æºé¡¹ç›®è§‚å¯Ÿ8æœˆæŠ¥"><img class="cover" src="/2023/08/23/opensource-monthly-202308/hue.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-23</div><div class="title">å¼€æºé¡¹ç›®è§‚å¯Ÿ8æœˆæŠ¥</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> è¯„è®º</span></div></div><div class="comment-wrap"><div><div id="gitalk-container"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://avatars.githubusercontent.com/u/14009307" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">smiecj</div><div class="author-info__description">å†™å†™ç”Ÿæ´»ï¼Œåšåšç¬”è®°ï¼ŒèŠèŠæ—¥å¸¸</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">æ–‡ç« </div><div class="length-num">46</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">æ ‡ç­¾</div><div class="length-num">42</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">åˆ†ç±»</div><div class="length-num">28</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/smiecj"><i class="fab fa-github"></i><span>è®¿é—®ä¸»é¡µ</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>ç›®å½•</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%8C%E6%99%AF"><span class="toc-number">1.</span> <span class="toc-text">èƒŒæ™¯</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#flink-cdc-%E5%8A%9F%E8%83%BD%E9%80%9F%E8%A7%88"><span class="toc-number">2.</span> <span class="toc-text">flink cdc åŠŸèƒ½é€Ÿè§ˆ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%8E%AF%E5%A2%83%E5%87%86%E5%A4%87"><span class="toc-number">3.</span> <span class="toc-text">ç¯å¢ƒå‡†å¤‡</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#flink-local-singleton"><span class="toc-number">3.1.</span> <span class="toc-text">flink local singleton</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flink-cdc-3-0"><span class="toc-number">3.2.</span> <span class="toc-text">flink cdc 3.0</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql"><span class="toc-number">3.3.</span> <span class="toc-text">mysql</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#doris"><span class="toc-number">3.4.</span> <span class="toc-text">doris</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%BB%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E8%BF%90%E8%A1%8C"><span class="toc-number">4.</span> <span class="toc-text">ä»»åŠ¡é…ç½®ä¸è¿è¡Œ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mysql-%E6%A8%A1%E6%8B%9F%E8%A1%A8"><span class="toc-number">4.1.</span> <span class="toc-text">mysql æ¨¡æ‹Ÿè¡¨</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%9A%E8%BF%87-dagagen-%E5%AE%9E%E6%97%B6%E5%90%91-mysql-%E5%86%99%E5%85%A5%E6%95%B0%E6%8D%AE"><span class="toc-number">4.2.</span> <span class="toc-text">é€šè¿‡ dagagen å®æ—¶å‘ mysql å†™å…¥æ•°æ®</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#flink-cdc-%E4%BB%BB%E5%8A%A1%E9%85%8D%E7%BD%AE%E4%B8%8E%E6%8F%90%E4%BA%A4"><span class="toc-number">4.3.</span> <span class="toc-text">flink cdc ä»»åŠ¡é…ç½®ä¸æäº¤</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#schema-evolution"><span class="toc-number">4.4.</span> <span class="toc-text">schema evolution</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B4%E5%BA%93%E5%90%8C%E6%AD%A5"><span class="toc-number">4.5.</span> <span class="toc-text">æ•´åº“åŒæ­¥</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">5.</span> <span class="toc-text">æ€»ç»“</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>æœ€æ–°æ–‡ç« </span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/10/06/cloudflare-zero-trust/" title="Cloudflare Zero Trust é…ç½®å†…ç½‘ç©¿é€"><img src="https://image.winudf.com/v2/image1/Y29tLnNhbmdmb3IudnBuLmNsaWVudC50YWJsZXRfc2NyZWVuXzBfMTU2NzAxNjA3M18wNjE" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Cloudflare Zero Trust é…ç½®å†…ç½‘ç©¿é€"/></a><div class="content"><a class="title" href="/2024/10/06/cloudflare-zero-trust/" title="Cloudflare Zero Trust é…ç½®å†…ç½‘ç©¿é€">Cloudflare Zero Trust é…ç½®å†…ç½‘ç©¿é€</a><time datetime="2024-10-05T16:00:00.000Z" title="å‘è¡¨äº 2024-10-06 00:00:00">2024-10-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/06/19/flink-cdc-3.0/" title="flink cdc 3.0 &quot;å°é²œ&quot;"><img src="/2024/06/19/flink-cdc-3.0/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="flink cdc 3.0 &quot;å°é²œ&quot;"/></a><div class="content"><a class="title" href="/2024/06/19/flink-cdc-3.0/" title="flink cdc 3.0 &quot;å°é²œ&quot;">flink cdc 3.0 &quot;å°é²œ&quot;</a><time datetime="2024-06-18T16:00:00.000Z" title="å‘è¡¨äº 2024-06-19 00:00:00">2024-06-19</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/04/25/azkaban-tools/" title="azkaban-tools é¡¹ç›®ä»‹ç»"><img src="/img/blog_img/azkaban.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="azkaban-tools é¡¹ç›®ä»‹ç»"/></a><div class="content"><a class="title" href="/2024/04/25/azkaban-tools/" title="azkaban-tools é¡¹ç›®ä»‹ç»">azkaban-tools é¡¹ç›®ä»‹ç»</a><time datetime="2024-04-24T16:00:00.000Z" title="å‘è¡¨äº 2024-04-25 00:00:00">2024-04-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/01/17/sadserver-intro/" title="make sadservers happy again"><img src="/2024/01/17/sadserver-intro/cover.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="make sadservers happy again"/></a><div class="content"><a class="title" href="/2024/01/17/sadserver-intro/" title="make sadservers happy again">make sadservers happy again</a><time datetime="2024-01-16T16:00:00.000Z" title="å‘è¡¨äº 2024-01-17 00:00:00">2024-01-17</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2023/12/06/program-100-qas/" title="äº’è”ç½‘ä¹‹100é—®"><img src="/2023/12/06/program-100-qas/cover.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="äº’è”ç½‘ä¹‹100é—®"/></a><div class="content"><a class="title" href="/2023/12/06/program-100-qas/" title="äº’è”ç½‘ä¹‹100é—®">äº’è”ç½‘ä¹‹100é—®</a><time datetime="2023-12-05T16:00:00.000Z" title="å‘è¡¨äº 2023-12-06 00:00:00">2023-12-06</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2024 By smiecj</div><div class="framework-info"><span>æ¡†æ¶ </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>ä¸»é¢˜ </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="æµ…è‰²å’Œæ·±è‰²æ¨¡å¼è½¬æ¢"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="è®¾ç½®"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="ç›®å½•"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="ç›´è¾¾è¯„è®º"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="å›åˆ°é¡¶éƒ¨"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">æœ¬åœ°æœç´¢</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="æœç´¢æ–‡ç« " type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>function addGitalkSource () {
  const ele = document.createElement('link')
  ele.rel = 'stylesheet'
  ele.href= 'https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css'
  document.getElementsByTagName('head')[0].appendChild(ele)
}

function loadGitalk () {
  function initGitalk () {
    var gitalk = new Gitalk(Object.assign({
      clientID: '40d352b09238233a6c88',
      clientSecret: 'db953d71dbaf0d65873a7ace2e60635fd475285a',
      repo: 'smiecj.github.io',
      owner: 'smiecj',
      admin: ['smiecj'],
      id: '942aad0966cb15476351853d63ed17e5',
      updateCountCallback: commentCount
    },null))

    gitalk.render('gitalk-container')
  }

  if (typeof Gitalk === 'function') initGitalk()
  else {
    addGitalkSource()
    getScript('https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js').then(initGitalk)
  }
}

function commentCount(n){
  let isCommentCount = document.querySelector('#post-meta .gitalk-comment-count')
  if (isCommentCount) {
    isCommentCount.innerHTML= n
  }
}

if ('Gitalk' === 'Gitalk' || !true) {
  if (true) btf.loadComment(document.getElementById('gitalk-container'), loadGitalk)
  else loadGitalk()
} else {
  function loadOtherComment () {
    loadGitalk()
  }
}</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>